/* Borrow.js Minified
 * GNU LGPL v.2.1 License
 * https://github.com/nasif-co/borrow.js */
let borrower={needs:{mouse:!1,url:!1,time:!1,deviceAcceleration:!1,deviceRotation:!1,keyboard:!1,scroll:!1,forms:!1,language:!1,network:!1,geolocation:!1,load:!1,pointerPressure:!1,counter:!1,random:!1},checkWhatToBorrow:function(){let stylesheets=document.styleSheets,ignoredStylesheets=[];const cssString=[...stylesheets].map((styleSheet=>{try{return[...styleSheet.cssRules].map((rule=>rule.cssText)).join("")}catch(e){ignoredStylesheets.push(styleSheet.href)}})).filter(Boolean).join("\n");ignoredStylesheets.length>0&&(console.groupCollapsed("Some stylesheets were ignored. Expand to see the complete list."),ignoredStylesheets.forEach((href=>{console.log(href)})),console.groupEnd()),(cssString.includes("--mouse-")||cssString.includes("[data-mouse-state")||cssString.includes("-click-count"))&&this.borrowMouse(),cssString.includes("[data-hash")&&this.borrowURL(),(cssString.includes("--acceleration")||cssString.includes("[data-acceleration")||cssString.includes("-rotation-"))&&(isSecureContext?((cssString.includes("--acceleration")||cssString.includes("[data-acceleration"))&&this.borrowAcceleration(),cssString.includes("-rotation-")&&this.borrowRotation()):console.warn("Current connection is not on a Secure Context. This means the following features will not be available: Rotation and Acceleration.\n\nPlease make sure that your domain name does not include special characters (like '#*%'), start or end with a hyphen ('-') or exceed 255 characters (as per RFC1035 Section 2.3.4). Breaking one or more of these rules may be causing your connection to be insecure.")),(cssString.includes("[data-active-keys")||cssString.includes("[data-toggled-keys"))&&this.borrowKeyboard(),(cssString.includes("--scroll-depth-")||cssString.includes("[data-scroll-depth"))&&this.borrowScroll(),cssString.includes("[data-language")&&this.borrowLanguage(),cssString.includes("[data-network-status")&&this.borrowNetwork(),cssString.includes("[data-load-state")&&this.borrowLoadEvents()},borrowMouse:function(){if(!window.matchMedia("(pointer: fine)").matches)return;borrower.globals.mousePos={x:0,y:0},document.body.style.setProperty("--mouse-x",borrower.globals.mousePos.x),document.body.style.setProperty("--mouse-y",borrower.globals.mousePos.y);const throttleLender=borrower.utils.throttle((function(e){borrower.globals.mousePos.x=parseFloat((e.clientX/window.innerWidth).toFixed(4)),borrower.globals.mousePos.y=parseFloat((e.clientY/window.innerHeight).toFixed(4)),document.body.style.setProperty("--mouse-x",borrower.globals.mousePos.x),document.body.style.setProperty("--mouse-y",borrower.globals.mousePos.y)}),25);window.addEventListener("mousemove",throttleLender),window.addEventListener("mousedown",(function(e){0==e.button&&(document.body.hasAttribute("data-mouse-state")&&document.body.getAttribute("data-mouse-state").includes("mouse-toggled")?document.body.removeAttribute("data-mouse-state"):document.body.setAttribute("data-mouse-state","mouse-toggled"))})),document.body.addEventListener("click",(function(e){if(0==e.button&&(borrower.globals.clickCount++,document.body.setAttribute("data-click-count",borrower.globals.clickCount),document.body.style.setProperty("--global-click-count",borrower.globals.clickCount),e.target!=e.currentTarget)){let localClickCount=1;null!=e.target.getAttribute("data-click-count")&&(localClickCount+=parseInt(e.target.getAttribute("data-click-count"))),e.target.setAttribute("data-click-count",borrower.globals.clickCount),e.target.style.setProperty("--click-count",borrower.globals.clickCount)}}))},borrowURL:function(){borrower.globals.urlHash=location.hash.substring(1),document.body.setAttribute("data-hash",borrower.globals.urlHash),window.addEventListener("hashchange",(function(){borrower.globals.urlHash=location.hash.substring(1),document.body.setAttribute("data-hash",borrower.globals.urlHash)}))},borrowTime:function(){},borrowAcceleration:function(){if(window.matchMedia("(pointer: fine)").matches)return;const throttleLender=borrower.utils.throttle((function(e){borrower.globals.deviceAcceleration={x:borrower.utils.constrain(e.acceleration.x/100,-1,1),y:borrower.utils.constrain(e.acceleration.y/100,-1,1),z:borrower.utils.constrain(e.acceleration.z/100,-1,1)},document.body.style.setProperty("--acceleration-x",borrower.globals.deviceAcceleration.x),document.body.style.setProperty("--acceleration-y",borrower.globals.deviceAcceleration.y),document.body.style.setProperty("--acceleration-z",borrower.globals.deviceAcceleration.z),Object.keys(borrower.globals.deviceAcceleration).forEach((key=>{let accelLevel="low";Math.abs(borrower.globals.deviceAcceleration[key])<.2?accelLevel="low":Math.abs(borrower.globals.deviceAcceleration[key])<.4?accelLevel="low-mid":Math.abs(borrower.globals.deviceAcceleration[key])<.6?accelLevel="mid":Math.abs(borrower.globals.deviceAcceleration[key])<.8?accelLevel="mid-high":Math.abs(borrower.globals.deviceAcceleration[key])<=1&&(accelLevel="high");let accelDirection="positive";borrower.globals.deviceAcceleration[key]<0&&(accelDirection="negative"),document.body.setAttribute("data-acceleration-"+key,accelDirection+" "+accelLevel)}))}),25);window.addEventListener("devicemotion",throttleLender)},borrowRotation:function(){if(window.matchMedia("(pointer: fine)").matches)return;borrower.globals.deviceRotation={normal:{x:0,y:0,z:0},continuous:{x:0,y:0,z:0}};let previousRotation={x:0,y:0,z:0};function getContinuousRotation(current,previous,continuous,minDegrees,maxDegrees){let limit=maxDegrees/2;return Math.abs(current-previous)<limit?current>previous?continuous+=Math.abs(current-previous):current<previous&&(continuous-=Math.abs(current-previous)):previous<current?(continuous-=previous-minDegrees,continuous-=maxDegrees-current):(continuous+=current-minDegrees,continuous+=maxDegrees-previous),continuous}const throttleLender=borrower.utils.throttle((function(e){previousRotation=borrower.globals.deviceRotation.normal,borrower.globals.deviceRotation.normal={x:e.beta,y:e.gamma,z:e.alpha},borrower.globals.deviceRotation.continuous={x:getContinuousRotation(borrower.globals.deviceRotation.normal.x,previousRotation.x,borrower.globals.deviceRotation.continuous.x,-180,180),y:getContinuousRotation(borrower.globals.deviceRotation.normal.y,previousRotation.y,borrower.globals.deviceRotation.continuous.y,-90,90),z:getContinuousRotation(borrower.globals.deviceRotation.normal.z,previousRotation.z,borrower.globals.deviceRotation.continuous.z,0,360)},document.body.style.setProperty("--cont-rotation-x",(borrower.globals.deviceRotation.continuous.x/360).toFixed(4)),document.body.style.setProperty("--rotation-x",(borrower.globals.deviceRotation.normal.x/360).toFixed(4)),document.body.style.setProperty("--cont-rotation-y",(borrower.globals.deviceRotation.continuous.y/360).toFixed(4)),document.body.style.setProperty("--rotation-y",(borrower.globals.deviceRotation.normal.y/360).toFixed(4)),document.body.style.setProperty("--cont-rotation-z",(borrower.globals.deviceRotation.continuous.z/360).toFixed(4)),document.body.style.setProperty("--rotation-z",(borrower.globals.deviceRotation.normal.z/360).toFixed(4))}),25);window.addEventListener("deviceorientation",throttleLender)},borrowKeyboard:function(){borrower.globals.pressedKeys=[],borrower.globals.toggledKeys=[];let activeKeyTimer=0;window.addEventListener("keydown",(function(e){e.isComposing||("Space"==e.code&&e.target==document.body&&e.preventDefault(),e.repeat?(clearTimeout(activeKeyTimer),activeKeyTimer=setTimeout((function(){-1!=borrower.globals.pressedKeys.indexOf(e.code)&&(borrower.globals.pressedKeys.splice(borrower.globals.pressedKeys.indexOf(e.code),1),document.body.setAttribute("data-active-keys",borrower.globals.pressedKeys.join(" ")))}),500)):-1==["CapsLock","Tab"].indexOf(e.code)&&-1==borrower.globals.pressedKeys.indexOf(e.code)&&(borrower.globals.pressedKeys.push(e.code),document.body.setAttribute("data-active-keys",borrower.globals.pressedKeys.join(" "))))})),window.addEventListener("keyup",(function(e){e.isComposing||(-1!=borrower.globals.pressedKeys.indexOf(e.code)&&(borrower.globals.pressedKeys.splice(borrower.globals.pressedKeys.indexOf(e.code),1),document.body.setAttribute("data-active-keys",borrower.globals.pressedKeys.join(" "))),-1==["CapsLock","Tab"].indexOf(e.code)&&(-1==borrower.globals.toggledKeys.indexOf(e.code)?borrower.globals.toggledKeys.push(e.code):borrower.globals.toggledKeys.splice(borrower.globals.toggledKeys.indexOf(e.code),1),document.body.setAttribute("data-toggled-keys",borrower.globals.toggledKeys.join(" "))))}))},borrowScroll:function(){borrower.globals.scrollDepth={y:0,x:0};const throttleLender=borrower.utils.throttle(lendScrollDepth,25);function lendScrollDepth(){window.innerHeight<document.body.scrollHeight?borrower.globals.scrollDepth.y=window.scrollY/(document.body.scrollHeight-window.innerHeight):borrower.globals.scrollDepth.y=0,window.innerWidth<document.body.scrollWidth?borrower.globals.scrollDepth.x=window.scrollX/(document.body.scrollWidth-window.innerWidth):borrower.globals.scrollDepth.x=0,document.body.style.setProperty("--scroll-depth-y",borrower.globals.scrollDepth.y.toFixed(4)),document.body.style.setProperty("--scroll-depth-x",borrower.globals.scrollDepth.x.toFixed(4));const scrollDepths=function(){const availableDepthsArr=[0,10,20,30,40,50,60,70,80,90,100],depthYTens=Math.trunc(10*borrower.globals.scrollDepth.y),depthXTens=Math.trunc(10*borrower.globals.scrollDepth.x),scrollDepths={y:availableDepthsArr.slice(0,depthYTens+1).join(" "),x:availableDepthsArr.slice(0,depthXTens+1).join(" ")};return scrollDepths}();document.body.setAttribute("data-scroll-depth-x",scrollDepths.x),document.body.setAttribute("data-scroll-depth-y",scrollDepths.y)}window.addEventListener("scroll",throttleLender),borrower.utils.runOnResize(lendScrollDepth)},borrowForms:function(){},borrowLanguage:function(){borrower.globals.language=navigator.language,document.body.setAttribute("data-language",borrower.globals.language),window.addEventListener("languagechange",(function(){borrower.globals.language=navigator.language,document.body.setAttribute("data-language",borrower.globals.language)}))},borrowNetwork:function(){borrower.globals.network="online",navigator.onLine||(borrower.globals.network="offline"),document.body.setAttribute("data-network-status",borrower.globals.network),window.addEventListener("online",(function(){borrower.globals.network="online",document.body.setAttribute("data-network-status",borrower.globals.network)})),window.addEventListener("offline",(function(){borrower.globals.network="offline",document.body.setAttribute("data-network-status",borrower.globals.network)}))},borrowGeolocation:function(){},borrowLoadEvents:function(){const imgs=document.querySelectorAll('img[src]:not([src=""])');null!=imgs&&Array.from(imgs).forEach((img=>{img.complete?0==img.naturalHeight?img.setAttribute("data-load-state","failed"):img.setAttribute("data-load-state","complete"):(img.setAttribute("data-load-state","loading"),img.addEventListener("load",(function(e){0==e.currentTarget.naturalHeight?e.currentTarget.setAttribute("data-load-state","failed"):e.currentTarget.setAttribute("data-load-state","complete")})))}));const iframes=document.querySelectorAll('iframe[src]:not([src=""])');null!=iframes&&Array.from(iframes).forEach((iframe=>{"complete"==iframe.readyState?iframe.setAttribute("data-load-state","complete"):(iframe.setAttribute("data-load-state","loading"),iframe.addEventListener("load",(function(e){e.currentTarget.setAttribute("data-load-state","complete")})))})),"complete"==document.readyState?document.body.setAttribute("data-load-state","complete"):(document.body.setAttribute("data-load-state","loading"),window.addEventListener("load",(function(){document.body.setAttribute("data-load-state","complete")})))},borrowPointerPressure:function(){},borrowCounter:function(){},borrowRandom:function(){},utils:{throttle:function(cb,delay){let wait=!1,storedArgs=null;function checkStoredArgs(){null==storedArgs?wait=!1:(cb(...storedArgs),storedArgs=null,setTimeout(checkStoredArgs,delay))}return(...args)=>{wait?storedArgs=args:(cb(...args),wait=!0,setTimeout(checkStoredArgs,delay))}},debounce:function(callback,wait){let timeoutId=null;return(...args)=>{window.clearTimeout(timeoutId),timeoutId=window.setTimeout((()=>{callback.apply(null,args)}),wait)}},runOnResize:function(callbackFunc,runOnLoad=!0){if("complete"===document.readyState){runOnLoad&&callbackFunc();const debouncedResize=borrower.utils.debounce(callbackFunc,200);window.addEventListener("resize",debouncedResize)}else window.addEventListener("load",(function(){runOnLoad&&callbackFunc();const debouncedResize=borrower.utils.debounce(callbackFunc,200);window.addEventListener("resize",debouncedResize)}))},runOnLoad:function(callbackFunc){"complete"===document.readyState?callbackFunc():window.addEventListener("load",(function(){callbackFunc()}))},map:function(n,start1,stop1,start2,stop2,withinBounds){const newval=(n-start1)/(stop1-start1)*(stop2-start2)+start2;return withinBounds?start2<stop2?borrower.utils.constrain(newval,start2,stop2):borrower.utils.constrain(newval,stop2,start2):newval},constrain:function(n,low,high){return Math.max(Math.min(n,high),low)}},globals:{mousePos:null,clickCount:0,pressedKeys:null,toggledKeys:null,urlHash:null,language:null,network:null,deviceRotation:null,deviceAcceleration:null,scrollDepth:null}};window.addEventListener("load",(function(){borrower.checkWhatToBorrow()}));
